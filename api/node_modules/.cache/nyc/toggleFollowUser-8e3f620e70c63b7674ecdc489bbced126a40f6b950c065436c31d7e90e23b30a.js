function cov_x664nu4l3(){var path="C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\user-logic\\toggleFollowUser.js";var hash="9a35698ae75a6f7113edc5a867e3e5afdd0b720f";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\user-logic\\toggleFollowUser.js",statementMap:{"0":{start:{line:1,column:17},end:{line:1,column:45}},"1":{start:{line:2,column:23},end:{line:2,column:55}},"2":{start:{line:5,column:4},end:{line:5,column:22}},"3":{start:{line:6,column:4},end:{line:6,column:29}},"4":{start:{line:8,column:4},end:{line:47,column:24}},"5":{start:{line:10,column:12},end:{line:10,column:56}},"6":{start:{line:10,column:23},end:{line:10,column:56}},"7":{start:{line:11,column:12},end:{line:11,column:70}},"8":{start:{line:11,column:30},end:{line:11,column:70}},"9":{start:{line:14,column:35},end:{line:14,column:71}},"10":{start:{line:16,column:26},end:{line:16,column:91}},"11":{start:{line:16,column:59},end:{line:16,column:90}},"12":{start:{line:18,column:12},end:{line:22,column:13}},"13":{start:{line:19,column:16},end:{line:19,column:52}},"14":{start:{line:21,column:16},end:{line:21,column:47}},"15":{start:{line:25,column:34},end:{line:25,column:54}},"16":{start:{line:27,column:30},end:{line:27,column:87}},"17":{start:{line:27,column:62},end:{line:27,column:86}},"18":{start:{line:29,column:12},end:{line:43,column:13}},"19":{start:{line:30,column:16},end:{line:30,column:44}},"20":{start:{line:32,column:16},end:{line:32,column:78}},"21":{start:{line:32,column:48},end:{line:32,column:78}},"22":{start:{line:34,column:37},end:{line:38,column:17}},"23":{start:{line:40,column:16},end:{line:40,column:60}},"24":{start:{line:42,column:16},end:{line:42,column:50}},"25":{start:{line:45,column:12},end:{line:45,column:65}},"26":{start:{line:50,column:0},end:{line:50,column:33}}},fnMap:{"0":{name:"toggleFollowUser",decl:{start:{line:4,column:9},end:{line:4,column:25}},loc:{start:{line:4,column:49},end:{line:48,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:9,column:14},end:{line:9,column:15}},loc:{start:{line:9,column:39},end:{line:46,column:9}},line:9},"2":{name:"(anonymous_2)",decl:{start:{line:16,column:51},end:{line:16,column:52}},loc:{start:{line:16,column:59},end:{line:16,column:90}},line:16},"3":{name:"(anonymous_3)",decl:{start:{line:27,column:54},end:{line:27,column:55}},loc:{start:{line:27,column:62},end:{line:27,column:86}},line:27},"4":{name:"(anonymous_4)",decl:{start:{line:47,column:14},end:{line:47,column:15}},loc:{start:{line:47,column:20},end:{line:47,column:23}},line:47}},branchMap:{"0":{loc:{start:{line:10,column:12},end:{line:10,column:56}},type:"if",locations:[{start:{line:10,column:12},end:{line:10,column:56}},{start:{line:10,column:12},end:{line:10,column:56}}],line:10},"1":{loc:{start:{line:11,column:12},end:{line:11,column:70}},type:"if",locations:[{start:{line:11,column:12},end:{line:11,column:70}},{start:{line:11,column:12},end:{line:11,column:70}}],line:11},"2":{loc:{start:{line:14,column:35},end:{line:14,column:71}},type:"cond-expr",locations:[{start:{line:14,column:52},end:{line:14,column:66}},{start:{line:14,column:69},end:{line:14,column:71}}],line:14},"3":{loc:{start:{line:18,column:12},end:{line:22,column:13}},type:"if",locations:[{start:{line:18,column:12},end:{line:22,column:13}},{start:{line:18,column:12},end:{line:22,column:13}}],line:18},"4":{loc:{start:{line:29,column:12},end:{line:43,column:13}},type:"if",locations:[{start:{line:29,column:12},end:{line:43,column:13}},{start:{line:29,column:12},end:{line:43,column:13}}],line:29},"5":{loc:{start:{line:32,column:16},end:{line:32,column:78}},type:"if",locations:[{start:{line:32,column:16},end:{line:32,column:78}},{start:{line:32,column:16},end:{line:32,column:78}}],line:32}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"9a35698ae75a6f7113edc5a867e3e5afdd0b720f"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_x664nu4l3=function(){return actualCoverage;};}return actualCoverage;}cov_x664nu4l3();const{User}=(cov_x664nu4l3().s[0]++,require('../../data/models'));const{validateId}=(cov_x664nu4l3().s[1]++,require('../helpers/validators'));function toggleFollowUser(userId,userIdProfile){cov_x664nu4l3().f[0]++;cov_x664nu4l3().s[2]++;validateId(userId);cov_x664nu4l3().s[3]++;validateId(userIdProfile);cov_x664nu4l3().s[4]++;return Promise.all([User.findById(userId),User.findById(userIdProfile)]).then(([user,userProfile])=>{cov_x664nu4l3().f[1]++;cov_x664nu4l3().s[5]++;if(!user){cov_x664nu4l3().b[0][0]++;cov_x664nu4l3().s[6]++;throw new Error('user not found');}else{cov_x664nu4l3().b[0][1]++;}cov_x664nu4l3().s[7]++;if(!userProfile){cov_x664nu4l3().b[1][0]++;cov_x664nu4l3().s[8]++;throw new Error('userProfile not found');}else{cov_x664nu4l3().b[1][1]++;}/* Modificar array de usuarios seguidos del usuario que realiza el follow */const followingUsers=(cov_x664nu4l3().s[9]++,user.following?(cov_x664nu4l3().b[2][0]++,user.following):(cov_x664nu4l3().b[2][1]++,[]));const index=(cov_x664nu4l3().s[10]++,followingUsers.findIndex(id=>{cov_x664nu4l3().f[2]++;cov_x664nu4l3().s[11]++;return userIdProfile===id.toString();}));cov_x664nu4l3().s[12]++;if(index===-1){cov_x664nu4l3().b[3][0]++;cov_x664nu4l3().s[13]++;followingUsers.push(userProfile._id);}else{cov_x664nu4l3().b[3][1]++;cov_x664nu4l3().s[14]++;followingUsers.splice(index,1);}/* Modificar array de usuarios seguidores del usuario que ha sido seguido */const followedUsers=(cov_x664nu4l3().s[15]++,userProfile.followed);const indexUser=(cov_x664nu4l3().s[16]++,followedUsers.findIndex(id=>{cov_x664nu4l3().f[3]++;cov_x664nu4l3().s[17]++;return userId===id.toString();}));cov_x664nu4l3().s[18]++;if(indexUser===-1){cov_x664nu4l3().b[4][0]++;cov_x664nu4l3().s[19]++;followedUsers.push(user._id);cov_x664nu4l3().s[20]++;if(!userProfile.notifications){cov_x664nu4l3().b[5][0]++;cov_x664nu4l3().s[21]++;userProfile.notifications=[];}else{cov_x664nu4l3().b[5][1]++;}const notification=(cov_x664nu4l3().s[22]++,{text:'Follow',user:user._id,date:new Date()});cov_x664nu4l3().s[23]++;userProfile.notifications.push(notification);}else{cov_x664nu4l3().b[4][1]++;cov_x664nu4l3().s[24]++;followedUsers.splice(indexUser,1);}cov_x664nu4l3().s[25]++;return Promise.all([user.save(),userProfile.save()]);}).then(()=>{cov_x664nu4l3().f[4]++;});}cov_x664nu4l3().s[26]++;module.exports=toggleFollowUser;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfeDY2NG51NGwzIiwiYWN0dWFsQ292ZXJhZ2UiLCJVc2VyIiwicyIsInJlcXVpcmUiLCJ2YWxpZGF0ZUlkIiwidG9nZ2xlRm9sbG93VXNlciIsInVzZXJJZCIsInVzZXJJZFByb2ZpbGUiLCJmIiwiUHJvbWlzZSIsImFsbCIsImZpbmRCeUlkIiwidGhlbiIsInVzZXIiLCJ1c2VyUHJvZmlsZSIsImIiLCJFcnJvciIsImZvbGxvd2luZ1VzZXJzIiwiZm9sbG93aW5nIiwiaW5kZXgiLCJmaW5kSW5kZXgiLCJpZCIsInRvU3RyaW5nIiwicHVzaCIsIl9pZCIsInNwbGljZSIsImZvbGxvd2VkVXNlcnMiLCJmb2xsb3dlZCIsImluZGV4VXNlciIsIm5vdGlmaWNhdGlvbnMiLCJub3RpZmljYXRpb24iLCJ0ZXh0IiwiZGF0ZSIsIkRhdGUiLCJzYXZlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInRvZ2dsZUZvbGxvd1VzZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBVc2VyIH0gPSByZXF1aXJlKCcuLi8uLi9kYXRhL21vZGVscycpXHJcbmNvbnN0IHsgdmFsaWRhdGVJZCB9ID0gcmVxdWlyZSgnLi4vaGVscGVycy92YWxpZGF0b3JzJylcclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZUZvbGxvd1VzZXIodXNlcklkLCB1c2VySWRQcm9maWxlKSB7XHJcbiAgICB2YWxpZGF0ZUlkKHVzZXJJZClcclxuICAgIHZhbGlkYXRlSWQodXNlcklkUHJvZmlsZSlcclxuXHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1VzZXIuZmluZEJ5SWQodXNlcklkKSwgVXNlci5maW5kQnlJZCh1c2VySWRQcm9maWxlKV0pXHJcbiAgICAgICAgLnRoZW4oKFt1c2VyLCB1c2VyUHJvZmlsZV0pID0+IHtcclxuICAgICAgICAgICAgaWYgKCF1c2VyKSB0aHJvdyBuZXcgRXJyb3IoJ3VzZXIgbm90IGZvdW5kJylcclxuICAgICAgICAgICAgaWYgKCF1c2VyUHJvZmlsZSkgdGhyb3cgbmV3IEVycm9yKCd1c2VyUHJvZmlsZSBub3QgZm91bmQnKVxyXG5cclxuICAgICAgICAgICAgLyogTW9kaWZpY2FyIGFycmF5IGRlIHVzdWFyaW9zIHNlZ3VpZG9zIGRlbCB1c3VhcmlvIHF1ZSByZWFsaXphIGVsIGZvbGxvdyAqL1xyXG4gICAgICAgICAgICBjb25zdCBmb2xsb3dpbmdVc2VycyA9IHVzZXIuZm9sbG93aW5nID8gdXNlci5mb2xsb3dpbmcgOiBbXVxyXG5cclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSBmb2xsb3dpbmdVc2Vycy5maW5kSW5kZXgoKGlkKSA9PiB1c2VySWRQcm9maWxlID09PSBpZC50b1N0cmluZygpKVxyXG5cclxuICAgICAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgZm9sbG93aW5nVXNlcnMucHVzaCh1c2VyUHJvZmlsZS5faWQpXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmb2xsb3dpbmdVc2Vycy5zcGxpY2UoaW5kZXgsIDEpXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8qIE1vZGlmaWNhciBhcnJheSBkZSB1c3VhcmlvcyBzZWd1aWRvcmVzIGRlbCB1c3VhcmlvIHF1ZSBoYSBzaWRvIHNlZ3VpZG8gKi9cclxuICAgICAgICAgICAgY29uc3QgZm9sbG93ZWRVc2VycyA9IHVzZXJQcm9maWxlLmZvbGxvd2VkXHJcblxyXG4gICAgICAgICAgICBjb25zdCBpbmRleFVzZXIgPSBmb2xsb3dlZFVzZXJzLmZpbmRJbmRleCgoaWQpID0+IHVzZXJJZCA9PT0gaWQudG9TdHJpbmcoKSlcclxuXHJcbiAgICAgICAgICAgIGlmIChpbmRleFVzZXIgPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBmb2xsb3dlZFVzZXJzLnB1c2godXNlci5faWQpXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCF1c2VyUHJvZmlsZS5ub3RpZmljYXRpb25zKSB1c2VyUHJvZmlsZS5ub3RpZmljYXRpb25zID0gW11cclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBub3RpZmljYXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0ZvbGxvdycsXHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcjogdXNlci5faWQsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0ZTogbmV3IERhdGUoKVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHVzZXJQcm9maWxlLm5vdGlmaWNhdGlvbnMucHVzaChub3RpZmljYXRpb24pXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmb2xsb3dlZFVzZXJzLnNwbGljZShpbmRleFVzZXIsIDEpXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbdXNlci5zYXZlKCksIHVzZXJQcm9maWxlLnNhdmUoKV0pXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbigoKSA9PiB7IH0pXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gdG9nZ2xlRm9sbG93VXNlciJdLCJtYXBwaW5ncyI6Ink0SUFlWTtBQUFBQSxhQUFBLFNBQUFBLENBQUEsU0FBQUMsY0FBQSxXQUFBQSxjQUFBLEVBQUFELGFBQUEsR0FmWixLQUFNLENBQUVFLElBQUssQ0FBQyxFQUFBRixhQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLG1CQUFtQixDQUFDLEVBQzdDLEtBQU0sQ0FBRUMsVUFBVyxDQUFDLEVBQUFMLGFBQUEsR0FBQUcsQ0FBQSxNQUFHQyxPQUFPLENBQUMsdUJBQXVCLENBQUMsRUFFdkQsUUFBUyxDQUFBRSxnQkFBZ0JBLENBQUNDLE1BQU0sQ0FBRUMsYUFBYSxDQUFFLENBQUFSLGFBQUEsR0FBQVMsQ0FBQSxNQUFBVCxhQUFBLEdBQUFHLENBQUEsTUFDN0NFLFVBQVUsQ0FBQ0UsTUFBTSxDQUFDLENBQUFQLGFB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