function cov_2nq777fhz6(){var path="C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\notifications-logic\\retrieveNotifications.js";var hash="c8d15bfa464b920c0eaffc4c5cde3a5cea18112e";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\notifications-logic\\retrieveNotifications.js",statementMap:{"0":{start:{line:1,column:23},end:{line:1,column:55}},"1":{start:{line:2,column:17},end:{line:2,column:47}},"2":{start:{line:5,column:4},end:{line:5,column:22}},"3":{start:{line:7,column:4},end:{line:33,column:10}},"4":{start:{line:12,column:12},end:{line:12,column:56}},"5":{start:{line:12,column:23},end:{line:12,column:56}},"6":{start:{line:14,column:12},end:{line:30,column:14}},"7":{start:{line:15,column:16},end:{line:18,column:17}},"8":{start:{line:16,column:20},end:{line:16,column:75}},"9":{start:{line:17,column:20},end:{line:17,column:48}},"10":{start:{line:20,column:16},end:{line:25,column:17}},"11":{start:{line:21,column:20},end:{line:24,column:21}},"12":{start:{line:22,column:24},end:{line:22,column:79}},"13":{start:{line:23,column:24},end:{line:23,column:52}},"14":{start:{line:27,column:16},end:{line:27,column:61}},"15":{start:{line:28,column:16},end:{line:28,column:39}},"16":{start:{line:29,column:16},end:{line:29,column:40}},"17":{start:{line:32,column:12},end:{line:32,column:47}},"18":{start:{line:36,column:0},end:{line:36,column:38}}},fnMap:{"0":{name:"retrieveNotifications",decl:{start:{line:4,column:9},end:{line:4,column:30}},loc:{start:{line:4,column:39},end:{line:34,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:11,column:14},end:{line:11,column:15}},loc:{start:{line:11,column:22},end:{line:33,column:9}},line:11},"2":{name:"(anonymous_2)",decl:{start:{line:14,column:39},end:{line:14,column:40}},loc:{start:{line:14,column:55},end:{line:30,column:13}},line:14}},branchMap:{"0":{loc:{start:{line:12,column:12},end:{line:12,column:56}},type:"if",locations:[{start:{line:12,column:12},end:{line:12,column:56}},{start:{line:12,column:12},end:{line:12,column:56}}],line:12},"1":{loc:{start:{line:15,column:16},end:{line:18,column:17}},type:"if",locations:[{start:{line:15,column:16},end:{line:18,column:17}},{start:{line:15,column:16},end:{line:18,column:17}}],line:15},"2":{loc:{start:{line:20,column:16},end:{line:25,column:17}},type:"if",locations:[{start:{line:20,column:16},end:{line:25,column:17}},{start:{line:20,column:16},end:{line:25,column:17}}],line:20},"3":{loc:{start:{line:21,column:20},end:{line:24,column:21}},type:"if",locations:[{start:{line:21,column:20},end:{line:24,column:21}},{start:{line:21,column:20},end:{line:24,column:21}}],line:21}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"c8d15bfa464b920c0eaffc4c5cde3a5cea18112e"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2nq777fhz6=function(){return actualCoverage;};}return actualCoverage;}cov_2nq777fhz6();const{validateId}=(cov_2nq777fhz6().s[0]++,require("../helpers/validators"));const{User}=(cov_2nq777fhz6().s[1]++,require("./../../data/models"));function retrieveNotifications(userId){cov_2nq777fhz6().f[0]++;cov_2nq777fhz6().s[2]++;validateId(userId);cov_2nq777fhz6().s[3]++;return User.findById(userId,'notifications -_id').populate({path:'notifications.user',select:'name image'}).populate({path:'notifications.post',select:'text image'}).sort({date:-1}).lean().then(user=>{cov_2nq777fhz6().f[1]++;cov_2nq777fhz6().s[4]++;if(!user){cov_2nq777fhz6().b[0][0]++;cov_2nq777fhz6().s[5]++;throw new Error('user not found');}else{cov_2nq777fhz6().b[0][1]++;}cov_2nq777fhz6().s[6]++;user.notifications.forEach(notification=>{cov_2nq777fhz6().f[2]++;cov_2nq777fhz6().s[7]++;if(notification.user._id){cov_2nq777fhz6().b[1][0]++;cov_2nq777fhz6().s[8]++;notification.user.id=notification.user._id.toString();cov_2nq777fhz6().s[9]++;delete notification.user._id;}else{cov_2nq777fhz6().b[1][1]++;}cov_2nq777fhz6().s[10]++;if(notification.post){cov_2nq777fhz6().b[2][0]++;cov_2nq777fhz6().s[11]++;if(notification.post._id){cov_2nq777fhz6().b[3][0]++;cov_2nq777fhz6().s[12]++;notification.post.id=notification.post._id.toString();cov_2nq777fhz6().s[13]++;delete notification.post._id;}else{cov_2nq777fhz6().b[3][1]++;}}else{cov_2nq777fhz6().b[2][1]++;}cov_2nq777fhz6().s[14]++;notification.id=notification._id.toString();cov_2nq777fhz6().s[15]++;delete notification._id;cov_2nq777fhz6().s[16]++;delete notification.date;});cov_2nq777fhz6().s[17]++;return user.notifications.reverse();});}cov_2nq777fhz6().s[18]++;module.exports=retrieveNotifications;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMm5xNzc3Zmh6NiIsImFjdHVhbENvdmVyYWdlIiwidmFsaWRhdGVJZCIsInMiLCJyZXF1aXJlIiwiVXNlciIsInJldHJpZXZlTm90aWZpY2F0aW9ucyIsInVzZXJJZCIsImYiLCJmaW5kQnlJZCIsInBvcHVsYXRlIiwicGF0aCIsInNlbGVjdCIsInNvcnQiLCJkYXRlIiwibGVhbiIsInRoZW4iLCJ1c2VyIiwiYiIsIkVycm9yIiwibm90aWZpY2F0aW9ucyIsImZvckVhY2giLCJub3RpZmljYXRpb24iLCJfaWQiLCJpZCIsInRvU3RyaW5nIiwicG9zdCIsInJldmVyc2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsicmV0cmlldmVOb3RpZmljYXRpb25zLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgdmFsaWRhdGVJZCB9ID0gcmVxdWlyZShcIi4uL2hlbHBlcnMvdmFsaWRhdG9yc1wiKTtcclxuY29uc3QgeyBVc2VyIH0gPSByZXF1aXJlKFwiLi8uLi8uLi9kYXRhL21vZGVsc1wiKVxyXG5cclxuZnVuY3Rpb24gcmV0cmlldmVOb3RpZmljYXRpb25zKHVzZXJJZCkge1xyXG4gICAgdmFsaWRhdGVJZCh1c2VySWQpXHJcblxyXG4gICAgcmV0dXJuIFVzZXIuZmluZEJ5SWQodXNlcklkLCAnbm90aWZpY2F0aW9ucyAtX2lkJylcclxuICAgICAgICAucG9wdWxhdGUoeyBwYXRoOiAnbm90aWZpY2F0aW9ucy51c2VyJywgc2VsZWN0OiAnbmFtZSBpbWFnZScgfSlcclxuICAgICAgICAucG9wdWxhdGUoeyBwYXRoOiAnbm90aWZpY2F0aW9ucy5wb3N0Jywgc2VsZWN0OiAndGV4dCBpbWFnZScgfSlcclxuICAgICAgICAuc29ydCh7IGRhdGU6IC0xIH0pLmxlYW4oKVxyXG4gICAgICAgIC50aGVuKHVzZXIgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBFcnJvcigndXNlciBub3QgZm91bmQnKVxyXG5cclxuICAgICAgICAgICAgdXNlci5ub3RpZmljYXRpb25zLmZvckVhY2gobm90aWZpY2F0aW9uID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChub3RpZmljYXRpb24udXNlci5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24udXNlci5pZCA9IG5vdGlmaWNhdGlvbi51c2VyLl9pZC50b1N0cmluZygpXHJcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG5vdGlmaWNhdGlvbi51c2VyLl9pZFxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChub3RpZmljYXRpb24ucG9zdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChub3RpZmljYXRpb24ucG9zdC5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLnBvc3QuaWQgPSBub3RpZmljYXRpb24ucG9zdC5faWQudG9TdHJpbmcoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgbm90aWZpY2F0aW9uLnBvc3QuX2lkXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5pZCA9IG5vdGlmaWNhdGlvbi5faWQudG9TdHJpbmcoKVxyXG4gICAgICAgICAgICAgICAgZGVsZXRlIG5vdGlmaWNhdGlvbi5faWRcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBub3RpZmljYXRpb24uZGF0ZVxyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHVzZXIubm90aWZpY2F0aW9ucy5yZXZlcnNlKClcclxuICAgICAgICB9KVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHJldHJpZXZlTm90aWZpY2F0aW9ucyJdLCJtYXBwaW5ncyI6IjJ0R0FlWTtBQUFBQSxjQUFBLFNBQUFBLENBQUEsU0FBQUMsY0FBQSxXQUFBQSxjQUFB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