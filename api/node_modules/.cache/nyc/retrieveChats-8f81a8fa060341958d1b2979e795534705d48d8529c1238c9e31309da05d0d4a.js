function cov_192vwfegbk(){var path="C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\chats-logic\\retrieveChats.js";var hash="26ee78f93b5d0c14fce930b158d9eddf2e575593";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\chats-logic\\retrieveChats.js",statementMap:{"0":{start:{line:1,column:17},end:{line:1,column:45}},"1":{start:{line:2,column:23},end:{line:2,column:55}},"2":{start:{line:5,column:4},end:{line:5,column:22}},"3":{start:{line:7,column:4},end:{line:34,column:10}},"4":{start:{line:11,column:12},end:{line:31,column:14}},"5":{start:{line:12,column:16},end:{line:12,column:34}},"6":{start:{line:13,column:16},end:{line:13,column:31}},"7":{start:{line:15,column:30},end:{line:15,column:90}},"8":{start:{line:15,column:59},end:{line:15,column:89}},"9":{start:{line:16,column:16},end:{line:16,column:43}},"10":{start:{line:18,column:16},end:{line:23,column:18}},"11":{start:{line:19,column:20},end:{line:22,column:21}},"12":{start:{line:20,column:24},end:{line:20,column:42}},"13":{start:{line:21,column:24},end:{line:21,column:39}},"14":{start:{line:25,column:16},end:{line:30,column:18}},"15":{start:{line:26,column:20},end:{line:29,column:21}},"16":{start:{line:27,column:24},end:{line:27,column:48}},"17":{start:{line:28,column:24},end:{line:28,column:42}},"18":{start:{line:33,column:12},end:{line:33,column:24}},"19":{start:{line:37,column:0},end:{line:37,column:30}}},fnMap:{"0":{name:"retrieveChats",decl:{start:{line:4,column:9},end:{line:4,column:22}},loc:{start:{line:4,column:31},end:{line:35,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:9,column:14},end:{line:9,column:15}},loc:{start:{line:9,column:23},end:{line:34,column:9}},line:9},"2":{name:"(anonymous_2)",decl:{start:{line:11,column:26},end:{line:11,column:27}},loc:{start:{line:11,column:34},end:{line:31,column:13}},line:11},"3":{name:"(anonymous_3)",decl:{start:{line:15,column:51},end:{line:15,column:52}},loc:{start:{line:15,column:59},end:{line:15,column:89}},line:15},"4":{name:"(anonymous_4)",decl:{start:{line:18,column:35},end:{line:18,column:36}},loc:{start:{line:18,column:43},end:{line:23,column:17}},line:18},"5":{name:"(anonymous_5)",decl:{start:{line:25,column:38},end:{line:25,column:39}},loc:{start:{line:25,column:49},end:{line:30,column:17}},line:25}},branchMap:{"0":{loc:{start:{line:19,column:20},end:{line:22,column:21}},type:"if",locations:[{start:{line:19,column:20},end:{line:22,column:21}},{start:{line:19,column:20},end:{line:22,column:21}}],line:19},"1":{loc:{start:{line:26,column:20},end:{line:29,column:21}},type:"if",locations:[{start:{line:26,column:20},end:{line:29,column:21}},{start:{line:26,column:20},end:{line:29,column:21}}],line:26}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"26ee78f93b5d0c14fce930b158d9eddf2e575593"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_192vwfegbk=function(){return actualCoverage;};}return actualCoverage;}cov_192vwfegbk();const{Chat}=(cov_192vwfegbk().s[0]++,require("../../data/models"));const{validateId}=(cov_192vwfegbk().s[1]++,require("../helpers/validators"));function retrieveChats(userId){cov_192vwfegbk().f[0]++;cov_192vwfegbk().s[2]++;validateId(userId);cov_192vwfegbk().s[3]++;return Chat.find({users:userId},'-__v').populate('users','name image').sort({date:-1}).lean().then(chats=>{cov_192vwfegbk().f[1]++;cov_192vwfegbk().s[4]++;chats.forEach(chat=>{cov_192vwfegbk().f[2]++;cov_192vwfegbk().s[5]++;chat.id=chat._id;cov_192vwfegbk().s[6]++;delete chat._id;const index=(cov_192vwfegbk().s[7]++,chat.users.findIndex(user=>{cov_192vwfegbk().f[3]++;cov_192vwfegbk().s[8]++;return user._id.toString()===userId;}));cov_192vwfegbk().s[9]++;chat.users.splice(index,1);cov_192vwfegbk().s[10]++;chat.users.forEach(user=>{cov_192vwfegbk().f[4]++;cov_192vwfegbk().s[11]++;if(user._id){cov_192vwfegbk().b[0][0]++;cov_192vwfegbk().s[12]++;user.id=user._id;cov_192vwfegbk().s[13]++;delete user._id;}else{cov_192vwfegbk().b[0][1]++;}});cov_192vwfegbk().s[14]++;chat.messages.forEach(message=>{cov_192vwfegbk().f[5]++;cov_192vwfegbk().s[15]++;if(message._id){cov_192vwfegbk().b[1][0]++;cov_192vwfegbk().s[16]++;message.id=message._id;cov_192vwfegbk().s[17]++;delete message._id;}else{cov_192vwfegbk().b[1][1]++;}});});cov_192vwfegbk().s[18]++;return chats;});}cov_192vwfegbk().s[19]++;module.exports=retrieveChats;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMTkydndmZWdiayIsImFjdHVhbENvdmVyYWdlIiwiQ2hhdCIsInMiLCJyZXF1aXJlIiwidmFsaWRhdGVJZCIsInJldHJpZXZlQ2hhdHMiLCJ1c2VySWQiLCJmIiwiZmluZCIsInVzZXJzIiwicG9wdWxhdGUiLCJzb3J0IiwiZGF0ZSIsImxlYW4iLCJ0aGVuIiwiY2hhdHMiLCJmb3JFYWNoIiwiY2hhdCIsImlkIiwiX2lkIiwiaW5kZXgiLCJmaW5kSW5kZXgiLCJ1c2VyIiwidG9TdHJpbmciLCJzcGxpY2UiLCJiIiwibWVzc2FnZXMiLCJtZXNzYWdlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInJldHJpZXZlQ2hhdHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBDaGF0IH0gPSByZXF1aXJlKFwiLi4vLi4vZGF0YS9tb2RlbHNcIik7XHJcbmNvbnN0IHsgdmFsaWRhdGVJZCB9ID0gcmVxdWlyZShcIi4uL2hlbHBlcnMvdmFsaWRhdG9yc1wiKTtcclxuXHJcbmZ1bmN0aW9uIHJldHJpZXZlQ2hhdHModXNlcklkKSB7XHJcbiAgICB2YWxpZGF0ZUlkKHVzZXJJZClcclxuXHJcbiAgICByZXR1cm4gQ2hhdC5maW5kKHsgdXNlcnM6IHVzZXJJZCB9LCAnLV9fdicpXHJcbiAgICAgICAgLnBvcHVsYXRlKCd1c2VycycsICduYW1lIGltYWdlJykuc29ydCh7IGRhdGU6IC0xIH0pLmxlYW4oKVxyXG4gICAgICAgIC50aGVuKGNoYXRzID0+IHtcclxuXHJcbiAgICAgICAgICAgIGNoYXRzLmZvckVhY2goY2hhdCA9PiB7XHJcbiAgICAgICAgICAgICAgICBjaGF0LmlkID0gY2hhdC5faWRcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBjaGF0Ll9pZFxyXG5cclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gY2hhdC51c2Vycy5maW5kSW5kZXgodXNlciA9PiB1c2VyLl9pZC50b1N0cmluZygpID09PSB1c2VySWQpXHJcbiAgICAgICAgICAgICAgICBjaGF0LnVzZXJzLnNwbGljZShpbmRleCwgMSlcclxuXHJcbiAgICAgICAgICAgICAgICBjaGF0LnVzZXJzLmZvckVhY2godXNlciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIuaWQgPSB1c2VyLl9pZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdXNlci5faWRcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgICAgIGNoYXQubWVzc2FnZXMuZm9yRWFjaChtZXNzYWdlID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZS5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5pZCA9IG1lc3NhZ2UuX2lkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBtZXNzYWdlLl9pZFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIH0pXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY2hhdHNcclxuICAgICAgICB9KVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHJldHJpZXZlQ2hhdHMiXSwibWFwcGluZ3MiOiJpeUdBZVk7QUFBQUEsY0FBQSxTQUFBQSxDQUFBLFNBQUFDLGNBQUEsV0FBQUEsY0FBQSxFQUFBRCxjQUFBLEdBZlosS0FBTSxDQUFFRSxJQUFLLENBQUMsRUFBQUYsY0FBQSxHQUFBRyxDQUFBLE1BQUdDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxFQUM3QyxLQUFNLENBQUVDLFVBQVcsQ0FBQyxFQUFBTCxjQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLHVCQUF1QixDQUFDLEVBRXZELFFBQVMsQ0FBQUUsYUFBYUEsQ0FBQ0MsTUFBTSxDQUFFLENBQUFQLGNBQUEs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