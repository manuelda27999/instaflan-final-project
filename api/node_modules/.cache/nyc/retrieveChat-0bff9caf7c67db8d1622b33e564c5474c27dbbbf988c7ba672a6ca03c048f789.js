function cov_12fyfci85r(){var path="C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\chats-logic\\retrieveChat.js";var hash="15b8dc7fe160c71480b60281eda107303c8705b1";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\chats-logic\\retrieveChat.js",statementMap:{"0":{start:{line:1,column:23},end:{line:1,column:51}},"1":{start:{line:2,column:23},end:{line:2,column:55}},"2":{start:{line:5,column:4},end:{line:5,column:22}},"3":{start:{line:6,column:4},end:{line:6,column:22}},"4":{start:{line:8,column:4},end:{line:43,column:10}},"5":{start:{line:10,column:12},end:{line:10,column:56}},"6":{start:{line:10,column:23},end:{line:10,column:56}},"7":{start:{line:11,column:12},end:{line:11,column:56}},"8":{start:{line:11,column:23},end:{line:11,column:56}},"9":{start:{line:13,column:26},end:{line:13,column:103}},"10":{start:{line:13,column:61},end:{line:13,column:102}},"11":{start:{line:14,column:12},end:{line:16,column:13}},"12":{start:{line:15,column:16},end:{line:15,column:47}},"13":{start:{line:18,column:12},end:{line:18,column:30}},"14":{start:{line:21,column:12},end:{line:22,column:74}},"15":{start:{line:26,column:12},end:{line:26,column:41}},"16":{start:{line:27,column:12},end:{line:27,column:27}},"17":{start:{line:29,column:26},end:{line:29,column:86}},"18":{start:{line:29,column:55},end:{line:29,column:85}},"19":{start:{line:30,column:12},end:{line:30,column:39}},"20":{start:{line:32,column:12},end:{line:35,column:14}},"21":{start:{line:33,column:16},end:{line:33,column:34}},"22":{start:{line:34,column:16},end:{line:34,column:31}},"23":{start:{line:37,column:12},end:{line:40,column:14}},"24":{start:{line:38,column:16},end:{line:38,column:51}},"25":{start:{line:39,column:16},end:{line:39,column:34}},"26":{start:{line:42,column:12},end:{line:42,column:23}},"27":{start:{line:46,column:0},end:{line:46,column:29}}},fnMap:{"0":{name:"retrieveChat",decl:{start:{line:4,column:9},end:{line:4,column:21}},loc:{start:{line:4,column:38},end:{line:44,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:9,column:14},end:{line:9,column:15}},loc:{start:{line:9,column:32},end:{line:19,column:9}},line:9},"2":{name:"(anonymous_2)",decl:{start:{line:13,column:51},end:{line:13,column:52}},loc:{start:{line:13,column:61},end:{line:13,column:102}},line:13},"3":{name:"(anonymous_3)",decl:{start:{line:20,column:14},end:{line:20,column:15}},loc:{start:{line:20,column:20},end:{line:23,column:9}},line:20},"4":{name:"(anonymous_4)",decl:{start:{line:24,column:14},end:{line:24,column:15}},loc:{start:{line:24,column:22},end:{line:43,column:9}},line:24},"5":{name:"(anonymous_5)",decl:{start:{line:29,column:47},end:{line:29,column:48}},loc:{start:{line:29,column:55},end:{line:29,column:85}},line:29},"6":{name:"(anonymous_6)",decl:{start:{line:32,column:31},end:{line:32,column:32}},loc:{start:{line:32,column:39},end:{line:35,column:13}},line:32},"7":{name:"(anonymous_7)",decl:{start:{line:37,column:34},end:{line:37,column:35}},loc:{start:{line:37,column:45},end:{line:40,column:13}},line:37}},branchMap:{"0":{loc:{start:{line:10,column:12},end:{line:10,column:56}},type:"if",locations:[{start:{line:10,column:12},end:{line:10,column:56}},{start:{line:10,column:12},end:{line:10,column:56}}],line:10},"1":{loc:{start:{line:11,column:12},end:{line:11,column:56}},type:"if",locations:[{start:{line:11,column:12},end:{line:11,column:56}},{start:{line:11,column:12},end:{line:11,column:56}}],line:11},"2":{loc:{start:{line:14,column:12},end:{line:16,column:13}},type:"if",locations:[{start:{line:14,column:12},end:{line:16,column:13}},{start:{line:14,column:12},end:{line:16,column:13}}],line:14}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"15b8dc7fe160c71480b60281eda107303c8705b1"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_12fyfci85r=function(){return actualCoverage;};}return actualCoverage;}cov_12fyfci85r();const{Chat,User}=(cov_12fyfci85r().s[0]++,require("../../data/models"));const{validateId}=(cov_12fyfci85r().s[1]++,require("../helpers/validators"));function retrieveChat(userId,chatId){cov_12fyfci85r().f[0]++;cov_12fyfci85r().s[2]++;validateId(userId);cov_12fyfci85r().s[3]++;validateId(chatId);cov_12fyfci85r().s[4]++;return Promise.all([Chat.findById(chatId,'-__v'),User.findById(userId,'-__v').lean()]).then(([chat,user])=>{cov_12fyfci85r().f[1]++;cov_12fyfci85r().s[5]++;if(!chat){cov_12fyfci85r().b[0][0]++;cov_12fyfci85r().s[6]++;throw new Error('chat not found');}else{cov_12fyfci85r().b[0][1]++;}cov_12fyfci85r().s[7]++;if(!user){cov_12fyfci85r().b[1][0]++;cov_12fyfci85r().s[8]++;throw new Error('user not found');}else{cov_12fyfci85r().b[1][1]++;}const index=(cov_12fyfci85r().s[9]++,chat.unreadFor.findIndex(userId=>{cov_12fyfci85r().f[2]++;cov_12fyfci85r().s[10]++;return userId.toString()===user._id.toString();}));cov_12fyfci85r().s[11]++;if(index>-1){cov_12fyfci85r().b[2][0]++;cov_12fyfci85r().s[12]++;chat.unreadFor.splice(index,1);}else{cov_12fyfci85r().b[2][1]++;}cov_12fyfci85r().s[13]++;return chat.save();}).then(()=>{cov_12fyfci85r().f[3]++;cov_12fyfci85r().s[14]++;return Chat.findById(chatId,'-__v').populate('users','name image').sort({date:-1}).lean();}).then(chat=>{cov_12fyfci85r().f[4]++;cov_12fyfci85r().s[15]++;chat.id=chat._id.toString();cov_12fyfci85r().s[16]++;delete chat._id;const index=(cov_12fyfci85r().s[17]++,chat.users.findIndex(user=>{cov_12fyfci85r().f[5]++;cov_12fyfci85r().s[18]++;return user._id.toString()===userId;}));cov_12fyfci85r().s[19]++;chat.users.splice(index,1);cov_12fyfci85r().s[20]++;chat.users.forEach(user=>{cov_12fyfci85r().f[6]++;cov_12fyfci85r().s[21]++;user.id=user._id;cov_12fyfci85r().s[22]++;delete user._id;});cov_12fyfci85r().s[23]++;chat.messages.forEach(message=>{cov_12fyfci85r().f[7]++;cov_12fyfci85r().s[24]++;message.id=message._id.toString();cov_12fyfci85r().s[25]++;delete message._id;});cov_12fyfci85r().s[26]++;return chat;});}cov_12fyfci85r().s[27]++;module.exports=retrieveChat;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMTJmeWZjaTg1ciIsImFjdHVhbENvdmVyYWdlIiwiQ2hhdCIsIlVzZXIiLCJzIiwicmVxdWlyZSIsInZhbGlkYXRlSWQiLCJyZXRyaWV2ZUNoYXQiLCJ1c2VySWQiLCJjaGF0SWQiLCJmIiwiUHJvbWlzZSIsImFsbCIsImZpbmRCeUlkIiwibGVhbiIsInRoZW4iLCJjaGF0IiwidXNlciIsImIiLCJFcnJvciIsImluZGV4IiwidW5yZWFkRm9yIiwiZmluZEluZGV4IiwidG9TdHJpbmciLCJfaWQiLCJzcGxpY2UiLCJzYXZlIiwicG9wdWxhdGUiLCJzb3J0IiwiZGF0ZSIsImlkIiwidXNlcnMiLCJmb3JFYWNoIiwibWVzc2FnZXMiLCJtZXNzYWdlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInJldHJpZXZlQ2hhdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IENoYXQsIFVzZXIgfSA9IHJlcXVpcmUoXCIuLi8uLi9kYXRhL21vZGVsc1wiKTtcclxuY29uc3QgeyB2YWxpZGF0ZUlkIH0gPSByZXF1aXJlKFwiLi4vaGVscGVycy92YWxpZGF0b3JzXCIpO1xyXG5cclxuZnVuY3Rpb24gcmV0cmlldmVDaGF0KHVzZXJJZCwgY2hhdElkKSB7XHJcbiAgICB2YWxpZGF0ZUlkKHVzZXJJZClcclxuICAgIHZhbGlkYXRlSWQoY2hhdElkKVxyXG5cclxuICAgIHJldHVybiBQcm9taXNlLmFsbChbQ2hhdC5maW5kQnlJZChjaGF0SWQsICctX192JyksIFVzZXIuZmluZEJ5SWQodXNlcklkLCAnLV9fdicpLmxlYW4oKV0pXHJcbiAgICAgICAgLnRoZW4oKFtjaGF0LCB1c2VyXSkgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWNoYXQpIHRocm93IG5ldyBFcnJvcignY2hhdCBub3QgZm91bmQnKVxyXG4gICAgICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBFcnJvcigndXNlciBub3QgZm91bmQnKVxyXG5cclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjaGF0LnVucmVhZEZvci5maW5kSW5kZXgodXNlcklkID0+IHVzZXJJZC50b1N0cmluZygpID09PSB1c2VyLl9pZC50b1N0cmluZygpKVxyXG4gICAgICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgY2hhdC51bnJlYWRGb3Iuc3BsaWNlKGluZGV4LCAxKVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gY2hhdC5zYXZlKClcclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIENoYXQuZmluZEJ5SWQoY2hhdElkLCAnLV9fdicpXHJcbiAgICAgICAgICAgICAgICAucG9wdWxhdGUoJ3VzZXJzJywgJ25hbWUgaW1hZ2UnKS5zb3J0KHsgZGF0ZTogLTEgfSkubGVhbigpXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbihjaGF0ID0+IHtcclxuXHJcbiAgICAgICAgICAgIGNoYXQuaWQgPSBjaGF0Ll9pZC50b1N0cmluZygpXHJcbiAgICAgICAgICAgIGRlbGV0ZSBjaGF0Ll9pZFxyXG5cclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjaGF0LnVzZXJzLmZpbmRJbmRleCh1c2VyID0+IHVzZXIuX2lkLnRvU3RyaW5nKCkgPT09IHVzZXJJZClcclxuICAgICAgICAgICAgY2hhdC51c2Vycy5zcGxpY2UoaW5kZXgsIDEpXHJcblxyXG4gICAgICAgICAgICBjaGF0LnVzZXJzLmZvckVhY2godXNlciA9PiB7XHJcbiAgICAgICAgICAgICAgICB1c2VyLmlkID0gdXNlci5faWRcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB1c2VyLl9pZFxyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgY2hhdC5tZXNzYWdlcy5mb3JFYWNoKG1lc3NhZ2UgPT4ge1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZS5pZCA9IG1lc3NhZ2UuX2lkLnRvU3RyaW5nKClcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBtZXNzYWdlLl9pZFxyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNoYXRcclxuICAgICAgICB9KVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHJldHJpZXZlQ2hhdCJdLCJtYXBwaW5ncyI6Ijh4SUFlWTtBQUFBQSxjQUFBLFNBQUFBLENBQUEsU0FBQUMsY0FBQSxXQUFBQSxjQUFBLEVBQUFELGNBQUEsR0FmWixLQUFNLENBQUVFLElBQUksQ0FBRUMsSUFBSyxDQUFDLEVBQUFILGNBQUEsR0FBQUksQ0FBQSxNQUFHQyxPQUFPLENBQUMsbUJBQW1CLENBQUMsRUFDbkQsS0FBTSxDQUFFQyxVQUFXLENBQUMsRUFBQU4sY0FBQSxHQUFBSSxDQUFBLE1BQUdDLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxFQUV2RCxRQUFTLENBQUFFLFlBQVlBLENBQUNDLE1BQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUFULGNBQUEsR0FBQVUsQ0FBQSxNQUFBVixjQUFBLEdBQUFJLENBQUEsTUFDbENFLFVBQVUsQ0FBQ0UsTUFBTSxDQUFDLENBQUFSLGNBQUEsR0FBQUksQ0FBQSxNQUNsQkUsVUFBVSxDQUFDRyxNQUFNLENBQUMsQ0FBQVQsY0FBQSxHQUFBSSxDQUFBLE1BRWxCLE1BQU8sQ0FBQU8sT0FBTyxDQUFDQyxHQUFHLENBQUMsQ0FBQ1YsSUFBSSxDQUFDVyxRQUFRLENBQUNKLE1BQU0sQ0FBRSxNQUFNLENBQUMsQ0FBRU4sSUFBSSxDQUFDVSxRQUFRLENBQUNMLE1BQU0sQ0FBRSxNQUFNLENBQUMsQ0FBQ00sSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ3BGQyxJQUFJLENBQUMsQ0FBQyxDQUFDQyxJQUFJLENBQUVDLElBQUksQ0FBQyxHQUFLLENBQUFqQixjQUFBLEdBQUFVLENBQUEsTUFBQVYsY0FBQSxHQUFBSSxDQUFBLE1BQ3BCLEdBQUksQ0FBQ1ksSUFBSSxDQUFFLENBQUFoQixjQUFBLEdBQUFrQixDQUFBLFNBQUFs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