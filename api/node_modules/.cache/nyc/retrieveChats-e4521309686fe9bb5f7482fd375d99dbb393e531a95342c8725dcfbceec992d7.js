function cov_192vwfegbk(){var path="C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\chats-logic\\retrieveChats.js";var hash="8a805c4980e819aecdbd0fba5f88e9cf771def3a";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\chats-logic\\retrieveChats.js",statementMap:{"0":{start:{line:1,column:17},end:{line:1,column:45}},"1":{start:{line:2,column:23},end:{line:2,column:55}},"2":{start:{line:5,column:4},end:{line:5,column:22}},"3":{start:{line:7,column:4},end:{line:35,column:6}},"4":{start:{line:10,column:8},end:{line:10,column:53}},"5":{start:{line:10,column:19},end:{line:10,column:53}},"6":{start:{line:12,column:8},end:{line:32,column:10}},"7":{start:{line:13,column:12},end:{line:13,column:30}},"8":{start:{line:14,column:12},end:{line:14,column:27}},"9":{start:{line:16,column:26},end:{line:16,column:86}},"10":{start:{line:16,column:55},end:{line:16,column:85}},"11":{start:{line:17,column:12},end:{line:17,column:39}},"12":{start:{line:19,column:12},end:{line:24,column:14}},"13":{start:{line:20,column:16},end:{line:23,column:17}},"14":{start:{line:21,column:20},end:{line:21,column:38}},"15":{start:{line:22,column:16},end:{line:22,column:31}},"16":{start:{line:26,column:12},end:{line:31,column:14}},"17":{start:{line:27,column:16},end:{line:30,column:17}},"18":{start:{line:28,column:20},end:{line:28,column:44}},"19":{start:{line:29,column:16},end:{line:29,column:34}},"20":{start:{line:34,column:8},end:{line:34,column:20}},"21":{start:{line:38,column:0},end:{line:38,column:30}}},fnMap:{"0":{name:"retrieveChats",decl:{start:{line:4,column:9},end:{line:4,column:22}},loc:{start:{line:4,column:31},end:{line:36,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:9,column:10},end:{line:9,column:11}},loc:{start:{line:9,column:19},end:{line:35,column:5}},line:9},"2":{name:"(anonymous_2)",decl:{start:{line:12,column:22},end:{line:12,column:23}},loc:{start:{line:12,column:30},end:{line:32,column:9}},line:12},"3":{name:"(anonymous_3)",decl:{start:{line:16,column:47},end:{line:16,column:48}},loc:{start:{line:16,column:55},end:{line:16,column:85}},line:16},"4":{name:"(anonymous_4)",decl:{start:{line:19,column:31},end:{line:19,column:32}},loc:{start:{line:19,column:38},end:{line:24,column:13}},line:19},"5":{name:"(anonymous_5)",decl:{start:{line:26,column:34},end:{line:26,column:35}},loc:{start:{line:26,column:45},end:{line:31,column:13}},line:26}},branchMap:{"0":{loc:{start:{line:10,column:8},end:{line:10,column:53}},type:"if",locations:[{start:{line:10,column:8},end:{line:10,column:53}},{start:{line:10,column:8},end:{line:10,column:53}}],line:10},"1":{loc:{start:{line:20,column:16},end:{line:23,column:17}},type:"if",locations:[{start:{line:20,column:16},end:{line:23,column:17}},{start:{line:20,column:16},end:{line:23,column:17}}],line:20},"2":{loc:{start:{line:27,column:16},end:{line:30,column:17}},type:"if",locations:[{start:{line:27,column:16},end:{line:30,column:17}},{start:{line:27,column:16},end:{line:30,column:17}}],line:27}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"8a805c4980e819aecdbd0fba5f88e9cf771def3a"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_192vwfegbk=function(){return actualCoverage;};}return actualCoverage;}cov_192vwfegbk();const{Chat}=(cov_192vwfegbk().s[0]++,require("../../data/models"));const{validateId}=(cov_192vwfegbk().s[1]++,require("../helpers/validators"));function retrieveChats(userId){cov_192vwfegbk().f[0]++;cov_192vwfegbk().s[2]++;validateId(userId);cov_192vwfegbk().s[3]++;return Chat.find({users:userId},'-__v').populate('users','name image').sort({date:-1}).lean().then(chats=>{cov_192vwfegbk().f[1]++;cov_192vwfegbk().s[4]++;if(!chats){cov_192vwfegbk().b[0][0]++;cov_192vwfegbk().s[5]++;throw new Error('chats not found');}else{cov_192vwfegbk().b[0][1]++;}cov_192vwfegbk().s[6]++;chats.forEach(chat=>{cov_192vwfegbk().f[2]++;cov_192vwfegbk().s[7]++;chat.id=chat._id;cov_192vwfegbk().s[8]++;delete chat._id;const index=(cov_192vwfegbk().s[9]++,chat.users.findIndex(user=>{cov_192vwfegbk().f[3]++;cov_192vwfegbk().s[10]++;return user._id.toString()===userId;}));cov_192vwfegbk().s[11]++;chat.users.splice(index,1);cov_192vwfegbk().s[12]++;chat.users.forEach(user=>{cov_192vwfegbk().f[4]++;cov_192vwfegbk().s[13]++;if(user._id){cov_192vwfegbk().b[1][0]++;cov_192vwfegbk().s[14]++;user.id=user._id;cov_192vwfegbk().s[15]++;delete user._id;}else{cov_192vwfegbk().b[1][1]++;}});cov_192vwfegbk().s[16]++;chat.messages.forEach(message=>{cov_192vwfegbk().f[5]++;cov_192vwfegbk().s[17]++;if(message._id){cov_192vwfegbk().b[2][0]++;cov_192vwfegbk().s[18]++;message.id=message._id;cov_192vwfegbk().s[19]++;delete message._id;}else{cov_192vwfegbk().b[2][1]++;}});});cov_192vwfegbk().s[20]++;return chats;});}cov_192vwfegbk().s[21]++;module.exports=retrieveChats;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMTkydndmZWdiayIsImFjdHVhbENvdmVyYWdlIiwiQ2hhdCIsInMiLCJyZXF1aXJlIiwidmFsaWRhdGVJZCIsInJldHJpZXZlQ2hhdHMiLCJ1c2VySWQiLCJmIiwiZmluZCIsInVzZXJzIiwicG9wdWxhdGUiLCJzb3J0IiwiZGF0ZSIsImxlYW4iLCJ0aGVuIiwiY2hhdHMiLCJiIiwiRXJyb3IiLCJmb3JFYWNoIiwiY2hhdCIsImlkIiwiX2lkIiwiaW5kZXgiLCJmaW5kSW5kZXgiLCJ1c2VyIiwidG9TdHJpbmciLCJzcGxpY2UiLCJtZXNzYWdlcyIsIm1lc3NhZ2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsicmV0cmlldmVDaGF0cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IENoYXQgfSA9IHJlcXVpcmUoXCIuLi8uLi9kYXRhL21vZGVsc1wiKTtcclxuY29uc3QgeyB2YWxpZGF0ZUlkIH0gPSByZXF1aXJlKFwiLi4vaGVscGVycy92YWxpZGF0b3JzXCIpO1xyXG5cclxuZnVuY3Rpb24gcmV0cmlldmVDaGF0cyh1c2VySWQpIHtcclxuICAgIHZhbGlkYXRlSWQodXNlcklkKVxyXG5cclxuICAgIHJldHVybiBDaGF0LmZpbmQoe3VzZXJzOiB1c2VySWR9LCAnLV9fdicpXHJcbiAgICAucG9wdWxhdGUoJ3VzZXJzJywgJ25hbWUgaW1hZ2UnKS5zb3J0KHtkYXRlOiAtMX0pLmxlYW4oKVxyXG4gICAgLnRoZW4oY2hhdHMgPT4ge1xyXG4gICAgICAgIGlmKCFjaGF0cykgdGhyb3cgbmV3IEVycm9yKCdjaGF0cyBub3QgZm91bmQnKVxyXG5cclxuICAgICAgICBjaGF0cy5mb3JFYWNoKGNoYXQgPT4ge1xyXG4gICAgICAgICAgICBjaGF0LmlkID0gY2hhdC5faWRcclxuICAgICAgICAgICAgZGVsZXRlIGNoYXQuX2lkXHJcblxyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IGNoYXQudXNlcnMuZmluZEluZGV4KHVzZXIgPT4gdXNlci5faWQudG9TdHJpbmcoKSA9PT0gdXNlcklkKVxyXG4gICAgICAgICAgICBjaGF0LnVzZXJzLnNwbGljZShpbmRleCwgMSlcclxuXHJcbiAgICAgICAgICAgIGNoYXQudXNlcnMuZm9yRWFjaCh1c2VyID0+e1xyXG4gICAgICAgICAgICAgICAgaWYodXNlci5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB1c2VyLmlkID0gdXNlci5faWRcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB1c2VyLl9pZFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgY2hhdC5tZXNzYWdlcy5mb3JFYWNoKG1lc3NhZ2UgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYobWVzc2FnZS5faWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmlkID0gbWVzc2FnZS5faWRcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBtZXNzYWdlLl9pZFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIHJldHVybiBjaGF0c1xyXG4gICAgfSlcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByZXRyaWV2ZUNoYXRzIl0sIm1hcHBpbmdzIjoidW1IQWVZO0FBQUFBLGNBQUEsU0FBQUEsQ0FBQSxTQUFBQyxjQUFBLFdBQUFBLGNBQUEsRUFBQUQsY0FBQSxHQWZaLEtBQU0sQ0FBRUUsSUFBSyxDQUFDLEVBQUFGLGNBQUEsR0FBQUcsQ0FBQSxNQUFHQyxPQUFPLENBQUMsbUJBQW1CLENBQUMsRUFDN0MsS0FBTSxDQUFFQyxVQUFXLENBQUMsRUFBQUwsY0FBQSxHQUFBRyxDQUFBLE1BQUdDLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxFQUV2RCxRQUFTLENBQUFFLGFBQWFBLENBQUNDLE1BQU0sQ0FBRSxDQUFBUCxjQUFBLEdBQUFRLENBQUEsTUFBQVIsY0FBQSxHQUFBRyxDQUFBLE1BQzNC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