function cov_2nq777fhz6(){var path="C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\notifications-logic\\retrieveNotifications.js";var hash="b59c46b1fa452801f7414f5130a8e8e803e57760";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\notifications-logic\\retrieveNotifications.js",statementMap:{"0":{start:{line:1,column:23},end:{line:1,column:55}},"1":{start:{line:2,column:17},end:{line:2,column:47}},"2":{start:{line:5,column:4},end:{line:5,column:22}},"3":{start:{line:7,column:4},end:{line:34,column:10}},"4":{start:{line:12,column:12},end:{line:12,column:56}},"5":{start:{line:12,column:23},end:{line:12,column:56}},"6":{start:{line:14,column:12},end:{line:31,column:14}},"7":{start:{line:16,column:16},end:{line:19,column:17}},"8":{start:{line:17,column:20},end:{line:17,column:75}},"9":{start:{line:18,column:20},end:{line:18,column:48}},"10":{start:{line:21,column:16},end:{line:26,column:17}},"11":{start:{line:22,column:20},end:{line:25,column:21}},"12":{start:{line:23,column:24},end:{line:23,column:79}},"13":{start:{line:24,column:24},end:{line:24,column:52}},"14":{start:{line:28,column:16},end:{line:28,column:61}},"15":{start:{line:29,column:16},end:{line:29,column:39}},"16":{start:{line:30,column:16},end:{line:30,column:40}},"17":{start:{line:33,column:12},end:{line:33,column:47}},"18":{start:{line:37,column:0},end:{line:37,column:38}}},fnMap:{"0":{name:"retrieveNotifications",decl:{start:{line:4,column:9},end:{line:4,column:30}},loc:{start:{line:4,column:39},end:{line:35,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:11,column:14},end:{line:11,column:15}},loc:{start:{line:11,column:22},end:{line:34,column:9}},line:11},"2":{name:"(anonymous_2)",decl:{start:{line:14,column:39},end:{line:14,column:40}},loc:{start:{line:14,column:55},end:{line:31,column:13}},line:14}},branchMap:{"0":{loc:{start:{line:12,column:12},end:{line:12,column:56}},type:"if",locations:[{start:{line:12,column:12},end:{line:12,column:56}},{start:{line:12,column:12},end:{line:12,column:56}}],line:12},"1":{loc:{start:{line:16,column:16},end:{line:19,column:17}},type:"if",locations:[{start:{line:16,column:16},end:{line:19,column:17}},{start:{line:16,column:16},end:{line:19,column:17}}],line:16},"2":{loc:{start:{line:21,column:16},end:{line:26,column:17}},type:"if",locations:[{start:{line:21,column:16},end:{line:26,column:17}},{start:{line:21,column:16},end:{line:26,column:17}}],line:21},"3":{loc:{start:{line:22,column:20},end:{line:25,column:21}},type:"if",locations:[{start:{line:22,column:20},end:{line:25,column:21}},{start:{line:22,column:20},end:{line:25,column:21}}],line:22}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"b59c46b1fa452801f7414f5130a8e8e803e57760"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2nq777fhz6=function(){return actualCoverage;};}return actualCoverage;}cov_2nq777fhz6();const{validateId}=(cov_2nq777fhz6().s[0]++,require("../helpers/validators"));const{User}=(cov_2nq777fhz6().s[1]++,require("./../../data/models"));function retrieveNotifications(userId){cov_2nq777fhz6().f[0]++;cov_2nq777fhz6().s[2]++;validateId(userId);cov_2nq777fhz6().s[3]++;return User.findById(userId,'notifications -_id').populate({path:'notifications.user',select:'name image'}).populate({path:'notifications.post',select:'text image'}).sort({date:-1}).lean().then(user=>{cov_2nq777fhz6().f[1]++;cov_2nq777fhz6().s[4]++;if(!user){cov_2nq777fhz6().b[0][0]++;cov_2nq777fhz6().s[5]++;throw new Error('user not found');}else{cov_2nq777fhz6().b[0][1]++;}cov_2nq777fhz6().s[6]++;user.notifications.forEach(notification=>{cov_2nq777fhz6().f[2]++;cov_2nq777fhz6().s[7]++;if(notification.user._id){cov_2nq777fhz6().b[1][0]++;cov_2nq777fhz6().s[8]++;notification.user.id=notification.user._id.toString();cov_2nq777fhz6().s[9]++;delete notification.user._id;}else{cov_2nq777fhz6().b[1][1]++;}cov_2nq777fhz6().s[10]++;if(notification.post){cov_2nq777fhz6().b[2][0]++;cov_2nq777fhz6().s[11]++;if(notification.post._id){cov_2nq777fhz6().b[3][0]++;cov_2nq777fhz6().s[12]++;notification.post.id=notification.post._id.toString();cov_2nq777fhz6().s[13]++;delete notification.post._id;}else{cov_2nq777fhz6().b[3][1]++;}}else{cov_2nq777fhz6().b[2][1]++;}cov_2nq777fhz6().s[14]++;notification.id=notification._id.toString();cov_2nq777fhz6().s[15]++;delete notification._id;cov_2nq777fhz6().s[16]++;delete notification.date;});cov_2nq777fhz6().s[17]++;return user.notifications.reverse();});}cov_2nq777fhz6().s[18]++;module.exports=retrieveNotifications;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMm5xNzc3Zmh6NiIsImFjdHVhbENvdmVyYWdlIiwidmFsaWRhdGVJZCIsInMiLCJyZXF1aXJlIiwiVXNlciIsInJldHJpZXZlTm90aWZpY2F0aW9ucyIsInVzZXJJZCIsImYiLCJmaW5kQnlJZCIsInBvcHVsYXRlIiwicGF0aCIsInNlbGVjdCIsInNvcnQiLCJkYXRlIiwibGVhbiIsInRoZW4iLCJ1c2VyIiwiYiIsIkVycm9yIiwibm90aWZpY2F0aW9ucyIsImZvckVhY2giLCJub3RpZmljYXRpb24iLCJfaWQiLCJpZCIsInRvU3RyaW5nIiwicG9zdCIsInJldmVyc2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsicmV0cmlldmVOb3RpZmljYXRpb25zLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgdmFsaWRhdGVJZCB9ID0gcmVxdWlyZShcIi4uL2hlbHBlcnMvdmFsaWRhdG9yc1wiKTtcclxuY29uc3QgeyBVc2VyIH0gPSByZXF1aXJlKFwiLi8uLi8uLi9kYXRhL21vZGVsc1wiKVxyXG5cclxuZnVuY3Rpb24gcmV0cmlldmVOb3RpZmljYXRpb25zKHVzZXJJZCkge1xyXG4gICAgdmFsaWRhdGVJZCh1c2VySWQpXHJcblxyXG4gICAgcmV0dXJuIFVzZXIuZmluZEJ5SWQodXNlcklkLCAnbm90aWZpY2F0aW9ucyAtX2lkJylcclxuICAgICAgICAucG9wdWxhdGUoeyBwYXRoOiAnbm90aWZpY2F0aW9ucy51c2VyJywgc2VsZWN0OiAnbmFtZSBpbWFnZScgfSlcclxuICAgICAgICAucG9wdWxhdGUoeyBwYXRoOiAnbm90aWZpY2F0aW9ucy5wb3N0Jywgc2VsZWN0OiAndGV4dCBpbWFnZScgfSlcclxuICAgICAgICAuc29ydCh7IGRhdGU6IC0xIH0pLmxlYW4oKVxyXG4gICAgICAgIC50aGVuKHVzZXIgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBFcnJvcigndXNlciBub3QgZm91bmQnKVxyXG5cclxuICAgICAgICAgICAgdXNlci5ub3RpZmljYXRpb25zLmZvckVhY2gobm90aWZpY2F0aW9uID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobm90aWZpY2F0aW9uLnVzZXIuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uLnVzZXIuaWQgPSBub3RpZmljYXRpb24udXNlci5faWQudG9TdHJpbmcoKVxyXG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBub3RpZmljYXRpb24udXNlci5faWRcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAobm90aWZpY2F0aW9uLnBvc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobm90aWZpY2F0aW9uLnBvc3QuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5wb3N0LmlkID0gbm90aWZpY2F0aW9uLnBvc3QuX2lkLnRvU3RyaW5nKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG5vdGlmaWNhdGlvbi5wb3N0Ll9pZFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb24uaWQgPSBub3RpZmljYXRpb24uX2lkLnRvU3RyaW5nKClcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSBub3RpZmljYXRpb24uX2lkXHJcbiAgICAgICAgICAgICAgICBkZWxldGUgbm90aWZpY2F0aW9uLmRhdGVcclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB1c2VyLm5vdGlmaWNhdGlvbnMucmV2ZXJzZSgpXHJcbiAgICAgICAgfSlcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByZXRyaWV2ZU5vdGlmaWNhdGlvbnMiXSwibWFwcGluZ3MiOiIydEdBZVk7QUFBQUEsY0FBQSxTQUFBQSxDQUFBLFNBQUFDLGNBQUEsV0FBQUEs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