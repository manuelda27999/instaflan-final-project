function cov_2paror32ha(){var path="C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\chats-logic\\deleteMessage.js";var hash="802058c83c4d352e1467a03fef955ee8d78e4d74";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\chats-logic\\deleteMessage.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:49}},"1":{start:{line:2,column:23},end:{line:2,column:55}},"2":{start:{line:5,column:4},end:{line:5,column:22}},"3":{start:{line:6,column:4},end:{line:6,column:25}},"4":{start:{line:8,column:4},end:{line:24,column:6}},"5":{start:{line:10,column:8},end:{line:10,column:51}},"6":{start:{line:10,column:18},end:{line:10,column:51}},"7":{start:{line:11,column:8},end:{line:11,column:51}},"8":{start:{line:11,column:18},end:{line:11,column:51}},"9":{start:{line:13,column:29},end:{line:13,column:101}},"10":{start:{line:13,column:64},end:{line:13,column:100}},"11":{start:{line:15,column:8},end:{line:15,column:128}},"12":{start:{line:15,column:70},end:{line:15,column:128}},"13":{start:{line:17,column:8},end:{line:17,column:91}},"14":{start:{line:17,column:49},end:{line:17,column:91}},"15":{start:{line:18,column:8},end:{line:18,column:99}},"16":{start:{line:18,column:57},end:{line:18,column:99}},"17":{start:{line:20,column:8},end:{line:20,column:45}},"18":{start:{line:21,column:8},end:{line:21,column:49}},"19":{start:{line:23,column:8},end:{line:23,column:26}},"20":{start:{line:27,column:0},end:{line:27,column:30}}},fnMap:{"0":{name:"deleteMessage",decl:{start:{line:4,column:9},end:{line:4,column:22}},loc:{start:{line:4,column:42},end:{line:25,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:9,column:10},end:{line:9,column:11}},loc:{start:{line:9,column:28},end:{line:24,column:5}},line:9},"2":{name:"(anonymous_2)",decl:{start:{line:13,column:53},end:{line:13,column:54}},loc:{start:{line:13,column:64},end:{line:13,column:100}},line:13}},branchMap:{"0":{loc:{start:{line:10,column:8},end:{line:10,column:51}},type:"if",locations:[{start:{line:10,column:8},end:{line:10,column:51}},{start:{line:10,column:8},end:{line:10,column:51}}],line:10},"1":{loc:{start:{line:11,column:8},end:{line:11,column:51}},type:"if",locations:[{start:{line:11,column:8},end:{line:11,column:51}},{start:{line:11,column:8},end:{line:11,column:51}}],line:11},"2":{loc:{start:{line:15,column:8},end:{line:15,column:128}},type:"if",locations:[{start:{line:15,column:8},end:{line:15,column:128}},{start:{line:15,column:8},end:{line:15,column:128}}],line:15},"3":{loc:{start:{line:17,column:8},end:{line:17,column:91}},type:"if",locations:[{start:{line:17,column:8},end:{line:17,column:91}},{start:{line:17,column:8},end:{line:17,column:91}}],line:17},"4":{loc:{start:{line:18,column:8},end:{line:18,column:99}},type:"if",locations:[{start:{line:18,column:8},end:{line:18,column:99}},{start:{line:18,column:8},end:{line:18,column:99}}],line:18}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"802058c83c4d352e1467a03fef955ee8d78e4d74"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2paror32ha=function(){return actualCoverage;};}return actualCoverage;}cov_2paror32ha();const{Chat,User}=(cov_2paror32ha().s[0]++,require("../../data/models"));const{validateId}=(cov_2paror32ha().s[1]++,require("../helpers/validators"));function deleteMessage(userId,messageId){cov_2paror32ha().f[0]++;cov_2paror32ha().s[2]++;validateId(userId);cov_2paror32ha().s[3]++;validateId(messageId);cov_2paror32ha().s[4]++;return Promise.all([User.findById(userId,'-__v').lean(),Chat.findOne({"messages._id":messageId},'-__v')]).then(([user,chat])=>{cov_2paror32ha().f[1]++;cov_2paror32ha().s[5]++;if(!user){cov_2paror32ha().b[0][0]++;cov_2paror32ha().s[6]++;throw new Error('user not found');}else{cov_2paror32ha().b[0][1]++;}cov_2paror32ha().s[7]++;if(!chat){cov_2paror32ha().b[1][0]++;cov_2paror32ha().s[8]++;throw new Error('chat not found');}else{cov_2paror32ha().b[1][1]++;}const indexMessage=(cov_2paror32ha().s[9]++,chat.messages.findIndex(message=>{cov_2paror32ha().f[2]++;cov_2paror32ha().s[10]++;return message._id.toString()===messageId;}));cov_2paror32ha().s[11]++;if(chat.messages[indexMessage].author.toString()!==userId){cov_2paror32ha().b[2][0]++;cov_2paror32ha().s[12]++;throw new Error('author of message and user are diferent');}else{cov_2paror32ha().b[2][1]++;}cov_2paror32ha().s[13]++;if(!chat.messages[indexMessage].delete){cov_2paror32ha().b[3][0]++;cov_2paror32ha().s[14]++;chat.messages[indexMessage].delete=false;}else{cov_2paror32ha().b[3][1]++;}cov_2paror32ha().s[15]++;if(chat.messages[indexMessage].delete===true){cov_2paror32ha().b[4][0]++;cov_2paror32ha().s[16]++;throw new Error('message already deleted');}else{cov_2paror32ha().b[4][1]++;}cov_2paror32ha().s[17]++;chat.messages[indexMessage].text='';cov_2paror32ha().s[18]++;chat.messages[indexMessage].delete=true;cov_2paror32ha().s[19]++;return chat.save();});}cov_2paror32ha().s[20]++;module.exports=deleteMessage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMnBhcm9yMzJoYSIsImFjdHVhbENvdmVyYWdlIiwiQ2hhdCIsIlVzZXIiLCJzIiwicmVxdWlyZSIsInZhbGlkYXRlSWQiLCJkZWxldGVNZXNzYWdlIiwidXNlcklkIiwibWVzc2FnZUlkIiwiZiIsIlByb21pc2UiLCJhbGwiLCJmaW5kQnlJZCIsImxlYW4iLCJmaW5kT25lIiwidGhlbiIsInVzZXIiLCJjaGF0IiwiYiIsIkVycm9yIiwiaW5kZXhNZXNzYWdlIiwibWVzc2FnZXMiLCJmaW5kSW5kZXgiLCJtZXNzYWdlIiwiX2lkIiwidG9TdHJpbmciLCJhdXRob3IiLCJkZWxldGUiLCJ0ZXh0Iiwic2F2ZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJkZWxldGVNZXNzYWdlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHtDaGF0LCBVc2VyfSA9IHJlcXVpcmUoXCIuLi8uLi9kYXRhL21vZGVsc1wiKVxyXG5jb25zdCB7IHZhbGlkYXRlSWQgfSA9IHJlcXVpcmUoXCIuLi9oZWxwZXJzL3ZhbGlkYXRvcnNcIilcclxuXHJcbmZ1bmN0aW9uIGRlbGV0ZU1lc3NhZ2UodXNlcklkLCBtZXNzYWdlSWQpIHtcclxuICAgIHZhbGlkYXRlSWQodXNlcklkKVxyXG4gICAgdmFsaWRhdGVJZChtZXNzYWdlSWQpXHJcblxyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFtVc2VyLmZpbmRCeUlkKHVzZXJJZCwgJy1fX3YnKS5sZWFuKCksIENoYXQuZmluZE9uZSh7XCJtZXNzYWdlcy5faWRcIjogbWVzc2FnZUlkfSwnLV9fdicpXSlcclxuICAgIC50aGVuKChbdXNlciwgY2hhdF0pID0+IHtcclxuICAgICAgICBpZighdXNlcikgdGhyb3cgbmV3IEVycm9yKCd1c2VyIG5vdCBmb3VuZCcpXHJcbiAgICAgICAgaWYoIWNoYXQpIHRocm93IG5ldyBFcnJvcignY2hhdCBub3QgZm91bmQnKVxyXG5cclxuICAgICAgICBjb25zdCBpbmRleE1lc3NhZ2UgPSBjaGF0Lm1lc3NhZ2VzLmZpbmRJbmRleChtZXNzYWdlID0+IG1lc3NhZ2UuX2lkLnRvU3RyaW5nKCkgPT09IG1lc3NhZ2VJZClcclxuXHJcbiAgICAgICAgaWYgKGNoYXQubWVzc2FnZXNbaW5kZXhNZXNzYWdlXS5hdXRob3IudG9TdHJpbmcoKSAhPT0gdXNlcklkKSB0aHJvdyBuZXcgRXJyb3IoJ2F1dGhvciBvZiBtZXNzYWdlIGFuZCB1c2VyIGFyZSBkaWZlcmVudCcpXHJcblxyXG4gICAgICAgIGlmICghY2hhdC5tZXNzYWdlc1tpbmRleE1lc3NhZ2VdLmRlbGV0ZSkgY2hhdC5tZXNzYWdlc1tpbmRleE1lc3NhZ2VdLmRlbGV0ZSA9IGZhbHNlIFxyXG4gICAgICAgIGlmIChjaGF0Lm1lc3NhZ2VzW2luZGV4TWVzc2FnZV0uZGVsZXRlID09PSB0cnVlKSB0aHJvdyBuZXcgRXJyb3IoJ21lc3NhZ2UgYWxyZWFkeSBkZWxldGVkJylcclxuXHJcbiAgICAgICAgY2hhdC5tZXNzYWdlc1tpbmRleE1lc3NhZ2VdLnRleHQgPSAnJ1xyXG4gICAgICAgIGNoYXQubWVzc2FnZXNbaW5kZXhNZXNzYWdlXS5kZWxldGUgPSB0cnVlIFxyXG5cclxuICAgICAgICByZXR1cm4gY2hhdC5zYXZlKClcclxuICAgIH0pXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gZGVsZXRlTWVzc2FnZSJdLCJtYXBwaW5ncyI6IjArR0FlWTtBQUFBQSxjQUFBLFNBQUFBLENBQUEsU0FBQUMsY0FBQSxXQUFBQSxjQUFBLEVBQUFELGNBQUEsR0FmWixLQUFNLENBQUNFLElBQUksQ0FBRUMsSUFBSSxDQUFDLEVBQUFILGNBQUEsR0FBQUksQ0FBQSxNQUFHQyxPQUFPLENBQUMsbUJBQW1CLENBQUMsRUFDakQsS0FBTSxDQUFFQyxVQUFXLENBQUMsRUFBQU4sY0FBQSxHQUFBSSxDQUFBLE1BQUdDLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxFQUV2RCxRQUFTLENBQUFFLGFBQWFBLENBQUNDLE1BQU0sQ0FBRUMsU0FBUyxDQUFFLENB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