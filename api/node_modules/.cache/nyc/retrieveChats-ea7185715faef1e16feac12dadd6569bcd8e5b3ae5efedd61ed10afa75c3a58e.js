function cov_192vwfegbk(){var path="C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\chats-logic\\retrieveChats.js";var hash="a6cf9cee9d61c472768ec7d84e54d3e741b6cf38";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\chats-logic\\retrieveChats.js",statementMap:{"0":{start:{line:1,column:17},end:{line:1,column:45}},"1":{start:{line:2,column:23},end:{line:2,column:55}},"2":{start:{line:5,column:4},end:{line:5,column:22}},"3":{start:{line:7,column:4},end:{line:35,column:10}},"4":{start:{line:10,column:12},end:{line:10,column:58}},"5":{start:{line:10,column:24},end:{line:10,column:58}},"6":{start:{line:12,column:12},end:{line:32,column:14}},"7":{start:{line:13,column:16},end:{line:13,column:34}},"8":{start:{line:14,column:16},end:{line:14,column:31}},"9":{start:{line:16,column:30},end:{line:16,column:90}},"10":{start:{line:16,column:59},end:{line:16,column:89}},"11":{start:{line:17,column:16},end:{line:17,column:43}},"12":{start:{line:19,column:16},end:{line:24,column:18}},"13":{start:{line:20,column:20},end:{line:23,column:21}},"14":{start:{line:21,column:24},end:{line:21,column:42}},"15":{start:{line:22,column:24},end:{line:22,column:39}},"16":{start:{line:26,column:16},end:{line:31,column:18}},"17":{start:{line:27,column:20},end:{line:30,column:21}},"18":{start:{line:28,column:24},end:{line:28,column:48}},"19":{start:{line:29,column:24},end:{line:29,column:42}},"20":{start:{line:34,column:12},end:{line:34,column:24}},"21":{start:{line:38,column:0},end:{line:38,column:30}}},fnMap:{"0":{name:"retrieveChats",decl:{start:{line:4,column:9},end:{line:4,column:22}},loc:{start:{line:4,column:31},end:{line:36,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:9,column:14},end:{line:9,column:15}},loc:{start:{line:9,column:23},end:{line:35,column:9}},line:9},"2":{name:"(anonymous_2)",decl:{start:{line:12,column:26},end:{line:12,column:27}},loc:{start:{line:12,column:34},end:{line:32,column:13}},line:12},"3":{name:"(anonymous_3)",decl:{start:{line:16,column:51},end:{line:16,column:52}},loc:{start:{line:16,column:59},end:{line:16,column:89}},line:16},"4":{name:"(anonymous_4)",decl:{start:{line:19,column:35},end:{line:19,column:36}},loc:{start:{line:19,column:43},end:{line:24,column:17}},line:19},"5":{name:"(anonymous_5)",decl:{start:{line:26,column:38},end:{line:26,column:39}},loc:{start:{line:26,column:49},end:{line:31,column:17}},line:26}},branchMap:{"0":{loc:{start:{line:10,column:12},end:{line:10,column:58}},type:"if",locations:[{start:{line:10,column:12},end:{line:10,column:58}},{start:{line:10,column:12},end:{line:10,column:58}}],line:10},"1":{loc:{start:{line:20,column:20},end:{line:23,column:21}},type:"if",locations:[{start:{line:20,column:20},end:{line:23,column:21}},{start:{line:20,column:20},end:{line:23,column:21}}],line:20},"2":{loc:{start:{line:27,column:20},end:{line:30,column:21}},type:"if",locations:[{start:{line:27,column:20},end:{line:30,column:21}},{start:{line:27,column:20},end:{line:30,column:21}}],line:27}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"a6cf9cee9d61c472768ec7d84e54d3e741b6cf38"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_192vwfegbk=function(){return actualCoverage;};}return actualCoverage;}cov_192vwfegbk();const{Chat}=(cov_192vwfegbk().s[0]++,require("../../data/models"));const{validateId}=(cov_192vwfegbk().s[1]++,require("../helpers/validators"));function retrieveChats(userId){cov_192vwfegbk().f[0]++;cov_192vwfegbk().s[2]++;validateId(userId);cov_192vwfegbk().s[3]++;return Chat.find({users:userId},'-__v').populate('users','name image').sort({date:-1}).lean().then(chats=>{cov_192vwfegbk().f[1]++;cov_192vwfegbk().s[4]++;if(!chats){cov_192vwfegbk().b[0][0]++;cov_192vwfegbk().s[5]++;throw new Error('chats not found');}else{cov_192vwfegbk().b[0][1]++;}cov_192vwfegbk().s[6]++;chats.forEach(chat=>{cov_192vwfegbk().f[2]++;cov_192vwfegbk().s[7]++;chat.id=chat._id;cov_192vwfegbk().s[8]++;delete chat._id;const index=(cov_192vwfegbk().s[9]++,chat.users.findIndex(user=>{cov_192vwfegbk().f[3]++;cov_192vwfegbk().s[10]++;return user._id.toString()===userId;}));cov_192vwfegbk().s[11]++;chat.users.splice(index,1);cov_192vwfegbk().s[12]++;chat.users.forEach(user=>{cov_192vwfegbk().f[4]++;cov_192vwfegbk().s[13]++;if(user._id){cov_192vwfegbk().b[1][0]++;cov_192vwfegbk().s[14]++;user.id=user._id;cov_192vwfegbk().s[15]++;delete user._id;}else{cov_192vwfegbk().b[1][1]++;}});cov_192vwfegbk().s[16]++;chat.messages.forEach(message=>{cov_192vwfegbk().f[5]++;cov_192vwfegbk().s[17]++;if(message._id){cov_192vwfegbk().b[2][0]++;cov_192vwfegbk().s[18]++;message.id=message._id;cov_192vwfegbk().s[19]++;delete message._id;}else{cov_192vwfegbk().b[2][1]++;}});});cov_192vwfegbk().s[20]++;return chats;});}cov_192vwfegbk().s[21]++;module.exports=retrieveChats;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMTkydndmZWdiayIsImFjdHVhbENvdmVyYWdlIiwiQ2hhdCIsInMiLCJyZXF1aXJlIiwidmFsaWRhdGVJZCIsInJldHJpZXZlQ2hhdHMiLCJ1c2VySWQiLCJmIiwiZmluZCIsInVzZXJzIiwicG9wdWxhdGUiLCJzb3J0IiwiZGF0ZSIsImxlYW4iLCJ0aGVuIiwiY2hhdHMiLCJiIiwiRXJyb3IiLCJmb3JFYWNoIiwiY2hhdCIsImlkIiwiX2lkIiwiaW5kZXgiLCJmaW5kSW5kZXgiLCJ1c2VyIiwidG9TdHJpbmciLCJzcGxpY2UiLCJtZXNzYWdlcyIsIm1lc3NhZ2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsicmV0cmlldmVDaGF0cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IENoYXQgfSA9IHJlcXVpcmUoXCIuLi8uLi9kYXRhL21vZGVsc1wiKTtcclxuY29uc3QgeyB2YWxpZGF0ZUlkIH0gPSByZXF1aXJlKFwiLi4vaGVscGVycy92YWxpZGF0b3JzXCIpO1xyXG5cclxuZnVuY3Rpb24gcmV0cmlldmVDaGF0cyh1c2VySWQpIHtcclxuICAgIHZhbGlkYXRlSWQodXNlcklkKVxyXG5cclxuICAgIHJldHVybiBDaGF0LmZpbmQoeyB1c2VyczogdXNlcklkIH0sICctX192JylcclxuICAgICAgICAucG9wdWxhdGUoJ3VzZXJzJywgJ25hbWUgaW1hZ2UnKS5zb3J0KHsgZGF0ZTogLTEgfSkubGVhbigpXHJcbiAgICAgICAgLnRoZW4oY2hhdHMgPT4ge1xyXG4gICAgICAgICAgICBpZiAoIWNoYXRzKSB0aHJvdyBuZXcgRXJyb3IoJ2NoYXRzIG5vdCBmb3VuZCcpXHJcblxyXG4gICAgICAgICAgICBjaGF0cy5mb3JFYWNoKGNoYXQgPT4ge1xyXG4gICAgICAgICAgICAgICAgY2hhdC5pZCA9IGNoYXQuX2lkXHJcbiAgICAgICAgICAgICAgICBkZWxldGUgY2hhdC5faWRcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGNoYXQudXNlcnMuZmluZEluZGV4KHVzZXIgPT4gdXNlci5faWQudG9TdHJpbmcoKSA9PT0gdXNlcklkKVxyXG4gICAgICAgICAgICAgICAgY2hhdC51c2Vycy5zcGxpY2UoaW5kZXgsIDEpXHJcblxyXG4gICAgICAgICAgICAgICAgY2hhdC51c2Vycy5mb3JFYWNoKHVzZXIgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh1c2VyLl9pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyLmlkID0gdXNlci5faWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHVzZXIuX2lkXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgICAgICBjaGF0Lm1lc3NhZ2VzLmZvckVhY2gobWVzc2FnZSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2UuX2lkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuaWQgPSBtZXNzYWdlLl9pZFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgbWVzc2FnZS5faWRcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB9KVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNoYXRzXHJcbiAgICAgICAgfSlcclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSByZXRyaWV2ZUNoYXRzIl0sIm1hcHBpbmdzIjoiK21IQWVZO0FBQUFBLGNBQUEsU0FBQUEsQ0FBQSxTQUFBQyxjQUFBLFdBQUFBLGNBQUEsRUFBQUQsY0FBQSxHQWZaLEtBQU0sQ0FBRUUsSUFBSyxDQUFDLEVBQUFGLGNBQUEsR0FBQUcsQ0FBQSxNQUFHQyxPQUFPLENBQUMsbUJBQW1CLENBQUMsRUFDN0MsS0FBTSxDQUFFQyxVQUFXLENBQUMsRUFBQUwsY0FBQSxHQUFBRyxDQUFBLE1BQUdDLE9B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