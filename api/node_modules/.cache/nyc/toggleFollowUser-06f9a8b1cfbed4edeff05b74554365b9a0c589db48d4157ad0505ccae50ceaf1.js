function cov_x664nu4l3(){var path="C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\user-logic\\toggleFollowUser.js";var hash="bd33e71ac43cefe7405629b19212431b1fa14ae2";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\loco8\\workspace\\eurofirms-bootcamp-202305\\staff\\manuel-david-castillo\\instaflan-fullstack\\api\\logic\\user-logic\\toggleFollowUser.js",statementMap:{"0":{start:{line:1,column:17},end:{line:1,column:45}},"1":{start:{line:2,column:23},end:{line:2,column:55}},"2":{start:{line:5,column:4},end:{line:5,column:22}},"3":{start:{line:6,column:4},end:{line:6,column:29}},"4":{start:{line:8,column:4},end:{line:45,column:24}},"5":{start:{line:10,column:12},end:{line:10,column:56}},"6":{start:{line:10,column:23},end:{line:10,column:56}},"7":{start:{line:11,column:12},end:{line:11,column:70}},"8":{start:{line:11,column:30},end:{line:11,column:70}},"9":{start:{line:14,column:35},end:{line:14,column:49}},"10":{start:{line:16,column:26},end:{line:16,column:91}},"11":{start:{line:16,column:59},end:{line:16,column:90}},"12":{start:{line:18,column:12},end:{line:22,column:13}},"13":{start:{line:19,column:16},end:{line:19,column:52}},"14":{start:{line:21,column:16},end:{line:21,column:47}},"15":{start:{line:25,column:34},end:{line:25,column:54}},"16":{start:{line:27,column:30},end:{line:27,column:87}},"17":{start:{line:27,column:62},end:{line:27,column:86}},"18":{start:{line:29,column:12},end:{line:41,column:13}},"19":{start:{line:30,column:16},end:{line:30,column:44}},"20":{start:{line:32,column:37},end:{line:36,column:17}},"21":{start:{line:38,column:16},end:{line:38,column:60}},"22":{start:{line:40,column:16},end:{line:40,column:50}},"23":{start:{line:43,column:12},end:{line:43,column:65}},"24":{start:{line:48,column:0},end:{line:48,column:33}}},fnMap:{"0":{name:"toggleFollowUser",decl:{start:{line:4,column:9},end:{line:4,column:25}},loc:{start:{line:4,column:49},end:{line:46,column:1}},line:4},"1":{name:"(anonymous_1)",decl:{start:{line:9,column:14},end:{line:9,column:15}},loc:{start:{line:9,column:39},end:{line:44,column:9}},line:9},"2":{name:"(anonymous_2)",decl:{start:{line:16,column:51},end:{line:16,column:52}},loc:{start:{line:16,column:59},end:{line:16,column:90}},line:16},"3":{name:"(anonymous_3)",decl:{start:{line:27,column:54},end:{line:27,column:55}},loc:{start:{line:27,column:62},end:{line:27,column:86}},line:27},"4":{name:"(anonymous_4)",decl:{start:{line:45,column:14},end:{line:45,column:15}},loc:{start:{line:45,column:20},end:{line:45,column:23}},line:45}},branchMap:{"0":{loc:{start:{line:10,column:12},end:{line:10,column:56}},type:"if",locations:[{start:{line:10,column:12},end:{line:10,column:56}},{start:{line:10,column:12},end:{line:10,column:56}}],line:10},"1":{loc:{start:{line:11,column:12},end:{line:11,column:70}},type:"if",locations:[{start:{line:11,column:12},end:{line:11,column:70}},{start:{line:11,column:12},end:{line:11,column:70}}],line:11},"2":{loc:{start:{line:18,column:12},end:{line:22,column:13}},type:"if",locations:[{start:{line:18,column:12},end:{line:22,column:13}},{start:{line:18,column:12},end:{line:22,column:13}}],line:18},"3":{loc:{start:{line:29,column:12},end:{line:41,column:13}},type:"if",locations:[{start:{line:29,column:12},end:{line:41,column:13}},{start:{line:29,column:12},end:{line:41,column:13}}],line:29}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"bd33e71ac43cefe7405629b19212431b1fa14ae2"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_x664nu4l3=function(){return actualCoverage;};}return actualCoverage;}cov_x664nu4l3();const{User}=(cov_x664nu4l3().s[0]++,require('../../data/models'));const{validateId}=(cov_x664nu4l3().s[1]++,require('../helpers/validators'));function toggleFollowUser(userId,userIdProfile){cov_x664nu4l3().f[0]++;cov_x664nu4l3().s[2]++;validateId(userId);cov_x664nu4l3().s[3]++;validateId(userIdProfile);cov_x664nu4l3().s[4]++;return Promise.all([User.findById(userId),User.findById(userIdProfile)]).then(([user,userProfile])=>{cov_x664nu4l3().f[1]++;cov_x664nu4l3().s[5]++;if(!user){cov_x664nu4l3().b[0][0]++;cov_x664nu4l3().s[6]++;throw new Error('user not found');}else{cov_x664nu4l3().b[0][1]++;}cov_x664nu4l3().s[7]++;if(!userProfile){cov_x664nu4l3().b[1][0]++;cov_x664nu4l3().s[8]++;throw new Error('userProfile not found');}else{cov_x664nu4l3().b[1][1]++;}/* Modificar array de usuarios seguidos del usuario que realiza el follow */const followingUsers=(cov_x664nu4l3().s[9]++,user.following);const index=(cov_x664nu4l3().s[10]++,followingUsers.findIndex(id=>{cov_x664nu4l3().f[2]++;cov_x664nu4l3().s[11]++;return userIdProfile===id.toString();}));cov_x664nu4l3().s[12]++;if(index===-1){cov_x664nu4l3().b[2][0]++;cov_x664nu4l3().s[13]++;followingUsers.push(userProfile._id);}else{cov_x664nu4l3().b[2][1]++;cov_x664nu4l3().s[14]++;followingUsers.splice(index,1);}/* Modificar array de usuarios seguidores del usuario que ha sido seguido */const followedUsers=(cov_x664nu4l3().s[15]++,userProfile.followed);const indexUser=(cov_x664nu4l3().s[16]++,followedUsers.findIndex(id=>{cov_x664nu4l3().f[3]++;cov_x664nu4l3().s[17]++;return userId===id.toString();}));cov_x664nu4l3().s[18]++;if(indexUser===-1){cov_x664nu4l3().b[3][0]++;cov_x664nu4l3().s[19]++;followedUsers.push(user._id);const notification=(cov_x664nu4l3().s[20]++,{text:'Follow',user:user._id,date:new Date()});cov_x664nu4l3().s[21]++;userProfile.notifications.push(notification);}else{cov_x664nu4l3().b[3][1]++;cov_x664nu4l3().s[22]++;followedUsers.splice(indexUser,1);}cov_x664nu4l3().s[23]++;return Promise.all([user.save(),userProfile.save()]);}).then(()=>{cov_x664nu4l3().f[4]++;});}cov_x664nu4l3().s[24]++;module.exports=toggleFollowUser;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfeDY2NG51NGwzIiwiYWN0dWFsQ292ZXJhZ2UiLCJVc2VyIiwicyIsInJlcXVpcmUiLCJ2YWxpZGF0ZUlkIiwidG9nZ2xlRm9sbG93VXNlciIsInVzZXJJZCIsInVzZXJJZFByb2ZpbGUiLCJmIiwiUHJvbWlzZSIsImFsbCIsImZpbmRCeUlkIiwidGhlbiIsInVzZXIiLCJ1c2VyUHJvZmlsZSIsImIiLCJFcnJvciIsImZvbGxvd2luZ1VzZXJzIiwiZm9sbG93aW5nIiwiaW5kZXgiLCJmaW5kSW5kZXgiLCJpZCIsInRvU3RyaW5nIiwicHVzaCIsIl9pZCIsInNwbGljZSIsImZvbGxvd2VkVXNlcnMiLCJmb2xsb3dlZCIsImluZGV4VXNlciIsIm5vdGlmaWNhdGlvbiIsInRleHQiLCJkYXRlIiwiRGF0ZSIsIm5vdGlmaWNhdGlvbnMiLCJzYXZlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInRvZ2dsZUZvbGxvd1VzZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyBVc2VyIH0gPSByZXF1aXJlKCcuLi8uLi9kYXRhL21vZGVscycpXHJcbmNvbnN0IHsgdmFsaWRhdGVJZCB9ID0gcmVxdWlyZSgnLi4vaGVscGVycy92YWxpZGF0b3JzJylcclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZUZvbGxvd1VzZXIodXNlcklkLCB1c2VySWRQcm9maWxlKSB7XHJcbiAgICB2YWxpZGF0ZUlkKHVzZXJJZClcclxuICAgIHZhbGlkYXRlSWQodXNlcklkUHJvZmlsZSlcclxuXHJcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1VzZXIuZmluZEJ5SWQodXNlcklkKSwgVXNlci5maW5kQnlJZCh1c2VySWRQcm9maWxlKV0pXHJcbiAgICAgICAgLnRoZW4oKFt1c2VyLCB1c2VyUHJvZmlsZV0pID0+IHtcclxuICAgICAgICAgICAgaWYgKCF1c2VyKSB0aHJvdyBuZXcgRXJyb3IoJ3VzZXIgbm90IGZvdW5kJylcclxuICAgICAgICAgICAgaWYgKCF1c2VyUHJvZmlsZSkgdGhyb3cgbmV3IEVycm9yKCd1c2VyUHJvZmlsZSBub3QgZm91bmQnKVxyXG5cclxuICAgICAgICAgICAgLyogTW9kaWZpY2FyIGFycmF5IGRlIHVzdWFyaW9zIHNlZ3VpZG9zIGRlbCB1c3VhcmlvIHF1ZSByZWFsaXphIGVsIGZvbGxvdyAqL1xyXG4gICAgICAgICAgICBjb25zdCBmb2xsb3dpbmdVc2VycyA9IHVzZXIuZm9sbG93aW5nXHJcblxyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IGZvbGxvd2luZ1VzZXJzLmZpbmRJbmRleCgoaWQpID0+IHVzZXJJZFByb2ZpbGUgPT09IGlkLnRvU3RyaW5nKCkpXHJcblxyXG4gICAgICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICBmb2xsb3dpbmdVc2Vycy5wdXNoKHVzZXJQcm9maWxlLl9pZClcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGZvbGxvd2luZ1VzZXJzLnNwbGljZShpbmRleCwgMSlcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLyogTW9kaWZpY2FyIGFycmF5IGRlIHVzdWFyaW9zIHNlZ3VpZG9yZXMgZGVsIHVzdWFyaW8gcXVlIGhhIHNpZG8gc2VndWlkbyAqL1xyXG4gICAgICAgICAgICBjb25zdCBmb2xsb3dlZFVzZXJzID0gdXNlclByb2ZpbGUuZm9sbG93ZWRcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4VXNlciA9IGZvbGxvd2VkVXNlcnMuZmluZEluZGV4KChpZCkgPT4gdXNlcklkID09PSBpZC50b1N0cmluZygpKVxyXG5cclxuICAgICAgICAgICAgaWYgKGluZGV4VXNlciA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIGZvbGxvd2VkVXNlcnMucHVzaCh1c2VyLl9pZClcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBub3RpZmljYXRpb24gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJ0ZvbGxvdycsXHJcbiAgICAgICAgICAgICAgICAgICAgdXNlcjogdXNlci5faWQsXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0ZTogbmV3IERhdGUoKVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHVzZXJQcm9maWxlLm5vdGlmaWNhdGlvbnMucHVzaChub3RpZmljYXRpb24pXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBmb2xsb3dlZFVzZXJzLnNwbGljZShpbmRleFVzZXIsIDEpXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbChbdXNlci5zYXZlKCksIHVzZXJQcm9maWxlLnNhdmUoKV0pXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbigoKSA9PiB7IH0pXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gdG9nZ2xlRm9sbG93VXNlciJdLCJtYXBwaW5ncyI6InMySEFlWTtBQUFBQSxhQUFBLFNBQUFBLENBQUEsU0FBQUMsY0FBQSxXQUFBQSxjQUFBLEVBQUFELGFBQUEsR0FmWixLQUFNLENBQUVFLElBQUssQ0FBQyxFQUFBRixhQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLG1CQUFtQixDQUFDLEVBQzdDLEtBQU0sQ0FBRUMsVUFBVyxDQUFDLEVBQUFMLGFBQUEsR0FBQUcsQ0FBQSxNQUFHQyxPQUFPLENBQUMsdUJBQXVCLENBQUMsRUFFdkQsUUFBUyxDQUFBRSxnQkFBZ0JBLENBQUNDLE1BQU0sQ0FBRUMsYUFBYSxDQUFFLENBQUFSLGFBQUEsR0FBQVMsQ0FBQSxNQUFBVCxhQUFBLEdBQUFHLENBQUEsTUFDN0NFLFVBQVUsQ0FBQ0UsTUFBTSxDQUFDLENBQUFQLGFBQUEsR0FBQUcsQ0FBQSxNQUNsQkUsVUFBVSxDQUFDRyxhQUFhLENBQUMsQ0FBQVIsYUFBQSxHQUFBRyxDQUFBLE1BRXpCLE1BQU8sQ0FBQU8sT0FBTyxDQUFDQyxHQUFHLENBQUMsQ0FBQ1Qs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